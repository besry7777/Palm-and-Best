<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>หมากฮอต Co-op</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            height: 100%;
        }
        
        .lobby {
            text-align: center;
            max-width: 500px;
            width: 100%;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .game-board {
            display: none;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1/1;
            background-color: #e0c9a6;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .dot {
            position: absolute;
            width: 8%;
            height: 8%;
            background-color: #333;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .line {
            position: absolute;
            background-color: #333;
            transform-origin: 0 0;
        }
        
        .piece {
            position: absolute;
            width: 6%;
            height: 6%;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s;
            z-index: 10;
        }
        
        .piece.red {
            background-color: #e74c3c;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .piece.blue {
            background-color: #3498db;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .piece.selected {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 10px rgba(0,0,0,0.8);
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #2ecc71;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #27ae60;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .player {
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            width: 48%;
            text-align: center;
        }
        
        .player.host {
            background-color: #e74c3c;
        }
        
        .player.guest {
            background-color: #3498db;
        }
        
        .status {
            margin: 10px 0;
            font-weight: bold;
        }
        
        .rules {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .rules h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .rules ol {
            padding-left: 20px;
        }
        
        .rules li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lobby" id="lobby">
            <h1>หมากฮอต Co-op</h1>
            <div id="joinSection">
                <input type="text" id="roomCode" placeholder="ใส่รหัสห้อง">
                <button id="joinBtn">เข้าร่วมห้อง</button>
                <p>หรือ</p>
                <button id="createBtn">สร้างห้องใหม่</button>
            </div>
            <div id="waitingSection" style="display: none;">
                <h2>รหัสห้อง: <span id="displayRoomCode"></span></h2>
                <p>ส่งลิงค์นี้ให้เพื่อน: <span id="roomLink"></span></p>
                <div class="player-info">
                    <div class="player host" id="hostPlayer">เจ้าของห้อง: คุณ</div>
                    <div class="player guest" id="guestPlayer">ผู้เล่น 2: กำลังรอ...</div>
                </div>
                <button id="startBtn" disabled>เริ่มเกม</button>
            </div>
        </div>
        
        <div class="game-board" id="gameBoard"></div>
        
        <div class="rules">
            <h3>กติกาสากลหมากฮอต</h3>
            <ol>
                <li>ผู้เล่นผลัดกันเดินทีละคน โดยเริ่มจากผู้เล่นสีแดง</li>
                <li>เดินหมากไปยังจุดที่ว่างโดยเชื่อมต่อกับเส้น</li>
                <li>เมื่อสามารถสร้างแถวของหมากตัวเอง 3 ตัวเรียงกัน ให้กินหมากของคู่ต่อสู้ 1 ตัว</li>
                <li>ผู้เล่นที่กินหมากคู่ต่อสู้จนเหลือน้อยกว่า 3 ตัวหรือทำให้คู่ต่อสู้เดินไม่ได้เป็นผู้ชนะ</li>
            </ol>
        </div>
    </div>

    <script>
        // ป้องกันการเลื่อนหน้าจอ
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // ป้องกันการดับเบิลคลิกซูม
        document.addEventListener('dblclick', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        // ตัวแปรเกม
        let isHost = false;
        let roomCode = '';
        let currentPlayer = 'red';
        let selectedPiece = null;
        let pieces = {};
        let lines = [];
        let dots = [];
        let gameStarted = false;
        
        // องค์ประกอบ DOM
        const lobby = document.getElementById('lobby');
        const gameBoard = document.getElementById('gameBoard');
        const joinSection = document.getElementById('joinSection');
        const waitingSection = document.getElementById('waitingSection');
        const roomCodeInput = document.getElementById('roomCode');
        const displayRoomCode = document.getElementById('displayRoomCode');
        const roomLink = document.getElementById('roomLink');
        const joinBtn = document.getElementById('joinBtn');
        const createBtn = document.getElementById('createBtn');
        const startBtn = document.getElementById('startBtn');
        const hostPlayer = document.getElementById('hostPlayer');
        const guestPlayer = document.getElementById('guestPlayer');
        
        // สร้างห้องใหม่
        createBtn.addEventListener('click', function() {
            isHost = true;
            roomCode = generateRoomCode();
            displayRoomCode.textContent = roomCode;
            roomLink.textContent = window.location.href.split('?')[0] + '?room=' + roomCode;
            
            joinSection.style.display = 'none';
            waitingSection.style.display = 'block';
            startBtn.disabled = true;
            
            // ในความเป็นจริงควรเชื่อมต่อกับเซิร์ฟเวอร์หรือ Firebase สำหรับการจัดการห้อง
            // แต่ในตัวอย่างนี้จะใช้การจำลอง
            setTimeout(() => {
                guestPlayer.textContent = 'ผู้เล่น 2: เพื่อน (สีน้ำเงิน)';
                startBtn.disabled = false;
            }, 2000);
        });
        
        // เข้าร่วมห้อง
        joinBtn.addEventListener('click', function() {
            roomCode = roomCodeInput.value.trim();
            if (roomCode.length === 0) {
                alert('กรุณากรอกรหัสห้อง');
                return;
            }
            
            isHost = false;
            displayRoomCode.textContent = roomCode;
            
            joinSection.style.display = 'none';
            waitingSection.style.display = 'block';
            hostPlayer.textContent = 'เจ้าของห้อง: เพื่อน (สีแดง)';
            guestPlayer.textContent = 'ผู้เล่น 2: คุณ (สีน้ำเงิน)';
            startBtn.style.display = 'none';
            
            // ในความเป็นจริงควรเชื่อมต่อกับเซิร์ฟเวอร์หรือ Firebase สำหรับการจัดการห้อง
            // แต่ในตัวอย่างนี้จะใช้การจำลอง
            setTimeout(() => {
                startGame();
            }, 2000);
        });
        
        // เริ่มเกม
        startBtn.addEventListener('click', function() {
            startGame();
        });
        
        // ฟังก์ชันเริ่มเกม
        function startGame() {
            lobby.style.display = 'none';
            gameBoard.style.display = 'block';
            gameStarted = true;
            
            initializeBoard();
        }
        
        // สร้างรหัสห้องแบบสุ่ม
        function generateRoomCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let result = '';
            for (let i = 0; i < 5; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // เริ่มต้นกระดานเกม
        function initializeBoard() {
            const boardSize = gameBoard.offsetWidth;
            const spacing = boardSize / 8;
            
            // สร้างจุด
            for (let row = 0; row < 7; row++) {
                for (let col = 0; col < 7; col++) {
                    if ((row < 2 || row > 4) && (col < 2 || col > 4)) continue;
                    
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    dot.style.left = `${col * spacing + spacing}px`;
                    dot.style.top = `${row * spacing + spacing}px`;
                    dot.dataset.row = row;
                    dot.dataset.col = col;
                    gameBoard.appendChild(dot);
                    dots.push({row, col});
                    
                    // เพิ่มหมาก
                    if ((row === 0 || row === 6) && col === 3) {
                        addPiece(row, col, 'red');
                    } else if ((col === 0 || col === 6) && row === 3) {
                        addPiece(row, col, 'blue');
                    }
                }
            }
            
            // สร้างเส้นเชื่อม
            createConnections();
            
            // เพิ่ม Event Listeners สำหรับหมาก
            document.querySelectorAll('.piece').forEach(piece => {
                piece.addEventListener('click', handlePieceClick);
            });
        }
        
        // เพิ่มหมาก
        function addPiece(row, col, color) {
            const boardSize = gameBoard.offsetWidth;
            const spacing = boardSize / 8;
            
            const piece = document.createElement('div');
            piece.className = `piece ${color}`;
            piece.style.left = `${col * spacing + spacing}px`;
            piece.style.top = `${row * spacing + spacing}px`;
            piece.dataset.row = row;
            piece.dataset.col = col;
            piece.dataset.color = color;
            gameBoard.appendChild(piece);
            
            pieces[`${row},${col}`] = {row, col, color, element: piece};
        }
        
        // สร้างเส้นเชื่อมระหว่างจุด
        function createConnections() {
            const boardSize = gameBoard.offsetWidth;
            const spacing = boardSize / 8;
            
            dots.forEach(dot1 => {
                dots.forEach(dot2 => {
                    // เชื่อมเฉพาะจุดที่อยู่ติดกันในแนวตั้งหรือแนวนอน
                    if ((Math.abs(dot1.row - dot2.row) === 1 && dot1.col === dot2.col) || 
                        (Math.abs(dot1.col - dot2.col) === 1 && dot1.row === dot2.row)) {
                        
                        const x1 = dot1.col * spacing + spacing;
                        const y1 = dot1.row * spacing + spacing;
                        const x2 = dot2.col * spacing + spacing;
                        const y2 = dot2.row * spacing + spacing;
                        
                        const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                        
                        const line = document.createElement('div');
                        line.className = 'line';
                        line.style.width = `${length}px`;
                        line.style.height = '2px';
                        line.style.left = `${x1}px`;
                        line.style.top = `${y1}px`;
                        line.style.transform = `rotate(${angle}deg)`;
                        line.dataset.from = `${dot1.row},${dot1.col}`;
                        line.dataset.to = `${dot2.row},${dot2.col}`;
                        gameBoard.appendChild(line);
                        
                        lines.push({
                            from: `${dot1.row},${dot1.col}`,
                            to: `${dot2.row},${dot2.col}`,
                            element: line
                        });
                    }
                });
            });
        }
        
        // จัดการเมื่อคลิกที่หมาก
        function handlePieceClick(e) {
            if (!gameStarted || currentPlayer !== (isHost ? 'red' : 'blue')) return;
            
            const piece = e.target;
            const color = piece.dataset.color;
            
            if (color !== currentPlayer) return;
            
            // เลือกหรือยกเลิกเลือกหมาก
            if (selectedPiece === piece) {
                piece.classList.remove('selected');
                selectedPiece = null;
            } else {
                if (selectedPiece) selectedPiece.classList.remove('selected');
                piece.classList.add('selected');
                selectedPiece = piece;
            }
        }
        
        // ในความเป็นจริงควรมีโค้ดสำหรับการเชื่อมต่อกับเซิร์ฟเวอร์หรือ Firebase
        // เพื่อให้ผู้เล่นสามารถเล่นร่วมกันได้จริง
        
        // ตรวจสอบว่ามีรหัสห้องใน URL หรือไม่ (สำหรับผู้เล่นที่เข้าร่วมผ่านลิงค์)
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomParam = urlParams.get('room');
            
            if (roomParam) {
                roomCodeInput.value = roomParam;
            }
        });
    </script>
</body>
</html>